<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tchat SELEZIONE PRO</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"></script>
  <style>
body {
  background: #181818;
  color: #fff;
  font-family: 'Outfit', 'Segoe UI', Arial, sans-serif;
}
.tchat-card {
  margin: 3em auto;
  max-width: 500px;
  padding: 2em 2em 1em 2em;
  background: #232323;
  border-radius: 22px;
  box-shadow: 0 4px 32px #0007;
}
#tchat-header {
  background: linear-gradient(90deg, #ffe259, #ffa751);
  color: #222;
  padding: 1.2em 1.3em;
  border-radius: 18px 18px 0 0;
  font-weight: bold;
  font-size: 1.20em;
  display: flex;
  align-items: center;
  gap: .8em;
  margin-bottom: 1em;
  letter-spacing: 0.5px;
}
#tchat-header .avatar {
  background: #fff3;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  color: #ffe259;
}
.tchat-form {
  display: flex;
  gap: 0.5em;
  margin-bottom: 0.5em;
  flex-wrap: wrap;
}
.tchat-form input[type="text"] {
  background: #191919;
  border: 1.5px solid #ffe25944;
  color: #fff;
  padding: .65em 1em;
  border-radius: 10px;
  outline: none;
  font-size: 1em;
  min-width: 110px;
  flex: 1 1 0px;
  margin-bottom: 0.2em;
}
.tchat-form input[type="text"]:focus {
  border-color: #ffe259;
}
.tchat-form button {
  background: linear-gradient(90deg, #ffe259 60%, #ffa751 100%);
  color: #181818;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: .65em 2em;
  font-size: 1.05em;
  cursor: pointer;
  transition: filter .15s;
  margin-bottom: 0.2em;
}
.tchat-form button:hover { filter: brightness(1.11); }

#result {
  margin-top: 0.8em;
  min-height: 100px;
  max-height: 300px;
  overflow-y: auto;
  padding: .5em .2em;
}
.msg-bubble {
  max-width: 70%;
  margin: 0.35em 0;
  padding: 0.70em 1.08em;
  border-radius: 1.7em;
  font-size: 1.11em;
  word-break: break-word;
  box-shadow: 0 1px 8px #0004;
  display: inline-block;
  position: relative;
  min-width: 68px;
}
.msg-me {
  background: linear-gradient(90deg, #ffe259 55%, #ffa751 100%);
  color: #191919;
  margin-left: 26%;
  text-align: right;
  float: right;
  clear: both;
  border: 2px solid #ffe25944;
}
.msg-other {
  background: #252525;
  color: #fff;
  margin-right: 26%;
  text-align: left;
  float: left;
  clear: both;
  border: 2px solid #ffe25926;
}
#debug {
  color: #ffb300;
  font-size: 0.95em;
  padding: .6em 0 0 0;
}
::-webkit-scrollbar {
  width: 8px;
  background: #222;
}
::-webkit-scrollbar-thumb {
  background: #292929;
  border-radius: 4px;
}
  </style>
</head>
<body>
  <div class="tchat-card">
    <div id="tchat-header">
      <span class="avatar">ðŸ‘‘</span>
      Tchat SELEZIONE PRO
    </div>
    <form class="tchat-form" onsubmit="envoyer(); return false;">
      <input type="text" id="pseudo" placeholder="Pseudo" value="Selezione" autocomplete="off"/>
      <input type="text" id="msg" placeholder="Message" autocomplete="off"/>
      <button type="submit">Envoyer</button>
    </form>
    <div id="result"></div>
    <div id="debug"></div>
  </div>
  <script>
    // -- Config Supabase
    const SUPABASE_URL = "https://gwcatbpsjbbhwekcsvkr.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3Y2F0YnBzamJiaHdla2NzdmtyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMTMzNDUsImV4cCI6MjA2Mzc4OTM0NX0.wMu7xBYKSUyzbcRRKDPGjX6iowDh9wdXFjyB71hl_to";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Fonction d'affichage des messages
    async function afficherMessages() {
      const { data, error } = await supabase.from('message').select('*').order('created_at', { ascending: true });
      const me = document.getElementById('pseudo').value;
      document.getElementById('result').innerHTML = "";
      if (data) {
        data.forEach(m => {
          const classe = m.pseudo === me ? "msg-bubble msg-me" : "msg-bubble msg-other";
          document.getElementById('result').innerHTML += `<div class="${classe}"><b>${m.pseudo}</b><br>${m.content}</div>`;
        });
      }
      document.getElementById('debug').innerText = error ? ("Erreur : " + error.message) : "";
    }

    // Chargement initial
    document.addEventListener("DOMContentLoaded", afficherMessages);

    // -- Envoi d'un message
    async function envoyer() {
      const pseudo = document.getElementById('pseudo').value;
      const msg = document.getElementById('msg').value;
      if(!pseudo || !msg) return;
      await supabase.from('message').insert([{ pseudo, content: msg }]);
      document.getElementById('msg').value = '';
      afficherMessages();
    }
  </script>
</body>
</html>
