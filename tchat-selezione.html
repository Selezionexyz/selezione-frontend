<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tchat SELEZIONE PRO</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&display=swap" rel="stylesheet">
  <style>
body {
  background: #191919;
  color: #fff;
  font-family: 'Outfit', 'Segoe UI', Arial, sans-serif;
}
#tchat-header {
  background: linear-gradient(90deg, #ffe259, #ffa751);
  color: #191919;
  padding: 1em 1.5em;
  border-radius: 18px 18px 0 0;
  font-weight: bold;
  font-size: 1.25em;
  display: flex;
  align-items: center;
  gap: .8em;
  margin-bottom: 0.3em;
  letter-spacing: 0.5px;
}
#tchat-header .avatar {
  background: #fff3;
  border-radius: 50%;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.35em;
  color: #ffe259;
}
#result {
  margin-top: 1em;
  min-height: 100px;
  max-height: 350px;
  overflow-y: auto;
  padding: .5em .2em;
}
.msg-bubble {
  max-width: 72%;
  margin: 0.35em 0;
  padding: 0.68em 1.08em;
  border-radius: 1.7em;
  font-size: 1.11em;
  word-break: break-word;
  box-shadow: 0 1px 8px #0004;
  display: inline-block;
  position: relative;
  min-width: 68px;
}
.msg-me {
  background: linear-gradient(90deg, #ffe259 55%, #ffa751 100%);
  color: #191919;
  margin-left: 26%;
  text-align: right;
  float: right;
  clear: both;
  border: 2px solid #ffe25944;
}
.msg-other {
  background: #252525;
  color: #fff;
  margin-right: 26%;
  text-align: left;
  float: left;
  clear: both;
  border: 2px solid #ffe25926;
}
input[type="text"] {
  background: #232323;
  border: 1px solid #ffe25944;
  color: #fff;
  padding: .7em 1em;
  border-radius: 10px;
  outline: none;
  margin-bottom: 0.4em;
  font-size: 1em;
  margin-right: 6px;
}
button {
  background: linear-gradient(90deg, #ffe259 60%, #ffa751 100%);
  color: #181818;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  padding: .7em 2.3em;
  font-size: 1.08em;
  cursor: pointer;
}
  </style>
</head>
<body>
  <div style="margin:2em auto;max-width:500px;padding:2em;background:#333;border-radius:8px;">
    <div id="tchat-header">
      <span class="avatar">ðŸ‘‘</span>
      Tchat SELEZIONE PRO
    </div>
    <input type="text" id="pseudo" placeholder="Pseudo" value="Selezione"/>
    <input type="text" id="msg" placeholder="Message" value="Coucou"/>
    <button onclick="envoyer()">Envoyer</button>
    <div id="result"></div>
    <div id="debug" style="margin-top:1em;color:#ffb300;"></div>
  </div>
  <script>
    // -- Config Supabase
    const SUPABASE_URL = "https://gwcatbpsjbbhwekcsvkr.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd3Y2F0YnBzamJiaHdla2NzdmtyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMTMzNDUsImV4cCI6MjA2Mzc4OTM0NX0.wMu7xBYKSUyzbcRRKDPGjX6iowDh9wdXFjyB71hl_to";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Fonction affichage messages
    async function afficherMessages() {
      const { data, error } = await supabase.from('message').select('*').order('created_at', { ascending: true });
      const me = document.getElementById('pseudo').value;
      document.getElementById('result').innerHTML = "";
      if (data) {
        data.forEach(m => {
          const classe = m.pseudo === me ? "msg-bubble msg-me" : "msg-bubble msg-other";
          document.getElementById('result').innerHTML += `<div class="${classe}"><b>${m.pseudo}</b><br>${m.content}</div>`;
        });
      }
      document.getElementById('debug').innerText = error ? "Erreur Supabase : " + error.message : "";
    }

    document.addEventListener("DOMContentLoaded", afficherMessages);

    // -- Envoi d'un message
    async function envoyer() {
      const pseudo = document.getElementById('pseudo').value;
      const msg = document.getElementById('msg').value;
      if(!pseudo || !msg) return;
      await supabase.from('message').insert([{ pseudo, content: msg }]);
      document.getElementById('msg').value = '';
      afficherMessages();
    }
  </script>
  <script>
  // -- Config Supabase
  const SUPABASE_URL = "https://gwcatbpsjbbhwekcsvkr.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // -- Affiche messages
  async function afficherMessages() {
    const { data } = await supabase.from('message').select('*').order('created_at', { ascending: true });
    const me = document.getElementById('pseudo').value;
    document.getElementById('result').innerHTML = "";
    if (data) {
      data.forEach(m => {
        const classe = m.pseudo === me ? "msg-bubble msg-me" : "msg-bubble msg-other";
        document.getElementById('result').innerHTML += `<div class="${classe}"><b>${m.pseudo}</b><br>${m.content}</div>`;
      });
    }
  }
  document.addEventListener("DOMContentLoaded", afficherMessages);

  // -- Envoi d'un message
  async function envoyer() {
    const pseudo = document.getElementById('pseudo').value;
    const msg = document.getElementById('msg').value;
    if(!pseudo || !msg) return;
    await supabase.from('message').insert([{ pseudo, content: msg }]);
    document.getElementById('msg').value = '';
    afficherMessages();
  }
  </script>
</body>
</html>
